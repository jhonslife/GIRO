
 RUN  v2.1.9 /home/jhonslife/CICLOGIRO/GIRO/apps/desktop

stdout | src/__tests__/AuditFlows.test.tsx > Audit: Critical Flows Integration > Flow: Full Cash Control Cycle
[Tauri] Invoking get_current_cash_session undefined
[MOCK INVOKE] get_current_cash_session 
[Invoke Result] get_current_cash_session: null

stdout | src/__tests__/AuditFlows.test.tsx > Audit: Critical Flows Integration > Flow: Full Cash Control Cycle
DEBUG: handleOpenSession called 100.00
[Tauri] Invoking open_cash_session { input: { openingBalance: 100, employeeId: 'admin-1' } }
[MOCK INVOKE] open_cash_session {"input":{"openingBalance":100,"employeeId":"admin-1"}}
[Invoke Result] open_cash_session: {
  id: 'sess-1768788314563',
  status: 'OPEN',
  openingBalance: 100,
  openedAt: '2026-01-19T02:05:14.563Z',
  current_balance: 100
}
[Tauri] Invoking get_current_cash_session undefined
[MOCK INVOKE] get_current_cash_session 
[Invoke Result] get_current_cash_session: {
  id: 'sess-1768788314563',
  status: 'OPEN',
  openingBalance: 100,
  openedAt: '2026-01-19T02:05:14.563Z',
  current_balance: 100
}
DEBUG: mutateAsync completed
[Tauri] Invoking get_session_movements { sessionId: 'sess-1768788314563' }
[MOCK INVOKE] get_session_movements {"sessionId":"sess-1768788314563"}
[Tauri] Invoking get_cash_session_summary { sessionId: 'sess-1768788314563' }
[MOCK INVOKE] get_cash_session_summary {"sessionId":"sess-1768788314563"}
DEBUG: Computing summary. Movements count: 0
[Invoke Result] get_session_movements: []
[Invoke Result] get_cash_session_summary: {
  session: {
    id: 'sess-1768788314563',
    status: 'OPEN',
    openingBalance: 100,
    openedAt: '2026-01-19T02:05:14.563Z',
    current_balance: 100
  },
  totalSales: 0,
  totalSupplies: 0,
  totalWithdrawals: 0,
  cashInDrawer: 100,
  movements: [],
  salesByMethod: []
}

stdout | src/__tests__/AuditFlows.test.tsx > Audit: Critical Flows Integration > Flow: Full Cash Control Cycle
[Tauri] Invoking add_cash_movement {
  input: {
    sessionId: 'sess-1768788314563',
    movementType: 'SUPPLY',
    amount: 50,
    description: 'Audit Supply'
  }
}
[MOCK INVOKE] add_cash_movement {"input":{"sessionId":"sess-1768788314563","movementType":"SUPPLY","amount":50,"description":"Audit Supply"}}
DEBUG: Added movement. New size: 1
[Invoke Result] add_cash_movement: null
DEBUG: useCashMovement onSuccess invalidating keys for session: sess-1768788314563
DEBUG: key summary: [ 'cashSession', 'summary', 'sess-1768788314563' ]
[Tauri] Invoking get_current_cash_session undefined
[MOCK INVOKE] get_current_cash_session 
[Tauri] Invoking get_cash_session_summary { sessionId: 'sess-1768788314563' }
[MOCK INVOKE] get_cash_session_summary {"sessionId":"sess-1768788314563"}
DEBUG: Computing summary. Movements count: 1
[Tauri] Invoking get_session_movements { sessionId: 'sess-1768788314563' }
[MOCK INVOKE] get_session_movements {"sessionId":"sess-1768788314563"}
[Invoke Result] get_current_cash_session: {
  id: 'sess-1768788314563',
  status: 'OPEN',
  openingBalance: 100,
  openedAt: '2026-01-19T02:05:14.563Z',
  current_balance: 100
}
[Invoke Result] get_cash_session_summary: {
  session: {
    id: 'sess-1768788314563',
    status: 'OPEN',
    openingBalance: 100,
    openedAt: '2026-01-19T02:05:14.563Z',
    current_balance: 100
  },
  totalSales: 0,
  totalSupplies: 50,
  totalWithdrawals: 0,
  cashInDrawer: 150,
  movements: [
    {
      id: 'mov-1768788314646',
      sessionId: 'sess-1768788314563',
      type: 'DEPOSIT',
      amount: 50,
      description: 'Audit Supply',
      createdAt: '2026-01-19T02:05:14.646Z'
    }
  ],
  salesByMethod: []
}
[Invoke Result] get_session_movements: [
  {
    id: 'mov-1768788314646',
    sessionId: 'sess-1768788314563',
    type: 'DEPOSIT',
    amount: 50,
    description: 'Audit Supply',
    createdAt: '2026-01-19T02:05:14.646Z'
  }
]

stdout | src/__tests__/AuditFlows.test.tsx > Audit: Critical Flows Integration > Flow: Full Cash Control Cycle
[Tauri] Invoking add_cash_movement {
  input: {
    sessionId: 'sess-1768788314563',
    movementType: 'BLEED',
    amount: 30,
    description: 'Audit Bleed'
  }
}
[MOCK INVOKE] add_cash_movement {"input":{"sessionId":"sess-1768788314563","movementType":"BLEED","amount":30,"description":"Audit Bleed"}}
DEBUG: Added movement. New size: 2
[Invoke Result] add_cash_movement: null
DEBUG: useCashMovement onSuccess invalidating keys for session: sess-1768788314563
DEBUG: key summary: [ 'cashSession', 'summary', 'sess-1768788314563' ]
[Tauri] Invoking get_current_cash_session undefined
[MOCK INVOKE] get_current_cash_session 
[Tauri] Invoking get_cash_session_summary { sessionId: 'sess-1768788314563' }
[MOCK INVOKE] get_cash_session_summary {"sessionId":"sess-1768788314563"}
DEBUG: Computing summary. Movements count: 2
[Tauri] Invoking get_session_movements { sessionId: 'sess-1768788314563' }
[MOCK INVOKE] get_session_movements {"sessionId":"sess-1768788314563"}
[Invoke Result] get_current_cash_session: {
  id: 'sess-1768788314563',
  status: 'OPEN',
  openingBalance: 100,
  openedAt: '2026-01-19T02:05:14.563Z',
  current_balance: 100
}
[Invoke Result] get_cash_session_summary: {
  session: {
    id: 'sess-1768788314563',
    status: 'OPEN',
    openingBalance: 100,
    openedAt: '2026-01-19T02:05:14.563Z',
    current_balance: 100
  },
  totalSales: 0,
  totalSupplies: 50,
  totalWithdrawals: 30,
  cashInDrawer: 120,
  movements: [
    {
      id: 'mov-1768788314646',
      sessionId: 'sess-1768788314563',
      type: 'DEPOSIT',
      amount: 50,
      description: 'Audit Supply',
      createdAt: '2026-01-19T02:05:14.646Z'
    },
    {
      id: 'mov-1768788314701',
      sessionId: 'sess-1768788314563',
      type: 'WITHDRAWAL',
      amount: 30,
      description: 'Audit Bleed',
      createdAt: '2026-01-19T02:05:14.701Z'
    }
  ],
  salesByMethod: []
}
[Invoke Result] get_session_movements: [
  {
    id: 'mov-1768788314646',
    sessionId: 'sess-1768788314563',
    type: 'DEPOSIT',
    amount: 50,
    description: 'Audit Supply',
    createdAt: '2026-01-19T02:05:14.646Z'
  },
  {
    id: 'mov-1768788314701',
    sessionId: 'sess-1768788314563',
    type: 'WITHDRAWAL',
    amount: 30,
    description: 'Audit Bleed',
    createdAt: '2026-01-19T02:05:14.701Z'
  }
]

 ✓ src/__tests__/AuditFlows.test.tsx (1 test) 316ms
   ✓ Audit: Critical Flows Integration > Flow: Full Cash Control Cycle 316ms

 Test Files  1 passed (1)
      Tests  1 passed (1)
   Start at  22:05:13
   Duration  1.53s (transform 163ms, setup 65ms, collect 516ms, tests 316ms, environment 301ms, prepare 173ms)

